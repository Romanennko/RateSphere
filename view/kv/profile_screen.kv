#:import ProfileScreen view.screens.profile_screen.ProfileScreen
#:import MDList kivymd.uix.list.MDList

<ProfileScreen>:
    name: "profile"
    md_bg_color: app.theme_cls.backgroundColor

    MDBoxLayout:
        orientation: "vertical"


        MDTopAppBar:
            type: "small"

            MDTopAppBarLeadingButtonContainer:
                MDActionTopAppBarButton:
                    icon: "menu"
                    on_release: app.open_app_bar_menu(self)

            MDTopAppBarTitle:
                text: "My Profile"

            MDTopAppBarTrailingButtonContainer:
                MDActionTopAppBarButton:
                    icon: "account-circle-outline"
                    on_release: app.open_profile_menu(self)

        MDScrollView:
            MDBoxLayout:
                id: content_box
                orientation: 'vertical'
                adaptive_height: True
                size_hint_y: None
                padding: "10dp"
                spacing: "15dp"

                MDCard:
                    style: "elevated"
                    padding: "10dp"
                    spacing: "5dp"
                    size_hint_y: None
                    height: self.minimum_height

                    MDListItem:
                        MDListItemHeadlineText:
                            id: username_label
                            text: "Username loading..."

                    MDListItem:
                        MDListItemLeadingIcon:
                            icon: "email-outline"

                        MDListItemHeadlineText:
                            id: email_label
                            text: "Email loading..."

                    MDListItem:
                        MDListItemLeadingIcon:
                            icon: "calendar-clock"

                        MDListItemHeadlineText:
                            id: joined_label
                            text: "Joined: loading..."
                            font_style: "Headline"
                            role: "small"


                MDCard:
                    style: "elevated"
                    padding: "10dp"
                    spacing: "5dp"
                    size_hint_y: None
                    height: self.minimum_height

                    MDLabel:
                        text: "Statistics"
                        font_style: "Headline"
                        role: "small"
                        adaptive_height: True
                        padding: ["5dp", "10dp"]


                    MDListItem:
                        MDListItemHeadlineText:
                            text: "Total Items Rated:"

                        MDListItemTertiaryText:
                            id: total_items_label
                            text: "-"

                    MDListItem:
                        MDListItemHeadlineText:
                            text: "Average Rating:"

                        MDListItemTertiaryText:
                            id: avg_rating_label
                            text: "N/A"

                    MDLabel:
                        text: "Counts by Type:"
                        font_style: "Headline"
                        role: "small"
                        adaptive_height: True
                        padding: ["5dp", "15dp", "5dp", "5dp"] # Отступы

                    MDList:
                        id: type_stats_list
                        size_hint_y: None
                        height: self.minimum_height

                    MDLabel:
                        text: "Counts by Status:"
                        font_style: "Headline"
                        role: "small"
                        adaptive_height: True
                        padding: ["5dp", "15dp", "5dp", "5dp"]

                    MDList:
                        id: status_stats_list
                        size_hint_y: None
                        height: self.minimum_height

                MDCard:
                    style: "elevated"
                    padding: "10dp"
                    spacing: "15dp"
                    size_hint_y: None
                    height: self.minimum_height

                    MDLabel:
                        text: "Account Management"
                        font_style: "Headline"
                        role: "small"
                        adaptive_height: True
                        padding: ["5dp", "10dp"]

                    MDTextField:
                        id: current_password
                        mode: "outlined"
                        password: True
                        size_hint_x: 0.8
                        pos_hint: {"center_x": 0.5}

                        MDTextFieldHintText:
                            text: "Current Password"

                    MDTextField:
                        id: new_password
                        mode: "outlined"
                        password: True
                        size_hint_x: 0.8
                        pos_hint: {"center_x": 0.5}

                        MDTextFieldHintText:
                            text: "New Password (min 6 chars)"

                    MDTextField:
                        id: confirm_password
                        mode: "outlined"
                        password: True
                        size_hint_x: 0.8
                        pos_hint: {"center_x": 0.5}

                        MDTextFieldHintText:
                            text: "Confirm New Password"

                    MDLabel:
                        id: password_feedback_label
                        text: ""
                        halign: "center"
                        theme_text_color: "Custom"
                        text_color: app.theme_cls.primaryColor
                        adaptive_height: True
                        size_hint_y: None
                        height: self.texture_size[1] if self.text else 0
                        padding: dp(5)

                    MDButton:
                        id: change_password_button
                        style: "filled"
                        pos_hint: {"center_x": 0.5}
                        on_release: app.profile_controller.change_password(current_password.text, new_password.text, confirm_password.text)

                        MDButtonText:
                            text: "Change Password"

                MDCard:
                    style: "elevated"
                    padding: "10dp"
                    spacing: "5dp"
                    size_hint_y: None
                    height: self.minimum_height

                    MDLabel:
                        text: "Settings"
                        font_style: "Headline"
                        role: "small"
                        adaptive_height: True
                        padding: ["5dp", "10dp"]

                    # TODO: Add items to customize sorting
                    MDListItem:
                        MDListItemHeadlineText:
                            text: "Default Sort Order"

                        MDListItemTertiaryText:
                            text: "(Coming soon)"